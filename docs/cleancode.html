<!DOCTYPE html><html><head>
      <title>article</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/michael/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.8.19/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="clean-code-vs-optimization-debunking-the-false-dichotomy">Clean Code vs. Optimization: Debunking the False Dichotomy </h1>
<h2 id="prologue-reexamining-clean-code-horrible-performance">Prologue: Reexamining "Clean Code, Horrible Performance" </h2>
<p>This article responds to Casey Muratori's provocative piece "Clean Code, Horrible Performance" (<a href="https://www.computerenhance.com/p/clean-code-horrible-performance">https://www.computerenhance.com/p/clean-code-horrible-performance</a>). Muratori argues that Robert C. Martin's "clean code" principles fundamentally compromise software performance, using shape area calculations to demonstrate his point. His central thesis is stark: clean code methodology makes software dramatically slower, with four of the five core principles proving detrimental to performance—sometimes by a factor of 15 or more.</p>
<p>Muratori contends that sacrificing a decade of hardware performance improvements for programmer convenience is unacceptable. While acknowledging that code organization and maintainability are worthy goals, he argues that current "clean code" practices fail to achieve them without imposing severe performance penalties.</p>
<p>This response unfolds across five parts:</p>
<ol>
<li><strong>Code Analysis</strong>: Examining the three implementations Muratori presented as his case study</li>
<li><strong>Context Setting</strong>: Discussing professional software development goals and where performance fits among quality attributes</li>
<li><strong>Hidden Costs</strong>: Analyzing what Muratori's optimizations sacrifice in terms of maintainability and extensibility</li>
<li><strong>Performance Evaluation</strong>: Critically examining the performance claims and their broader implications</li>
<li><strong>Synthesis</strong>: Presenting a clean code solution that achieves performance exceeding even the "optimized" implementations by over 4x, proving that clean code and performance need not be mutually exclusive</li>
</ol>
<h2 id="part-1-the-code-competing-for-performance">Part 1: The Code Competing for Performance </h2>
<p>The original article "Clean Code Horrible Performance" compares three approaches to shape area and corner-weighted area calculations in C++:</p>
<h3 id="clean-code-oop">Clean Code (OOP) </h3>
<p>A clean object-oriented design using virtual methods:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Base class and derived shape classes</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">shape_base</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-virtual">virtual</span> f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-virtual">virtual</span> u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">square</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">square</span><span class="token punctuation">(</span>f32 SideInit<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Side</span><span class="token punctuation">(</span>SideInit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> Side <span class="token operator">*</span> Side<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 Side<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">rectangle</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">rectangle</span><span class="token punctuation">(</span>f32 WidthInit<span class="token punctuation">,</span> f32 HeightInit<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Width</span><span class="token punctuation">(</span>WidthInit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Height</span><span class="token punctuation">(</span>HeightInit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> Width <span class="token operator">*</span> Height<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 Width<span class="token punctuation">,</span> Height<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">triangle</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">triangle</span><span class="token punctuation">(</span>f32 BaseInit<span class="token punctuation">,</span> f32 HeightInit<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Base</span><span class="token punctuation">(</span>BaseInit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Height</span><span class="token punctuation">(</span>HeightInit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">0.5f</span> <span class="token operator">*</span> Base <span class="token operator">*</span> Height<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 Base<span class="token punctuation">,</span> Height<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">circle</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">circle</span><span class="token punctuation">(</span>f32 RadiusInit<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Radius</span><span class="token punctuation">(</span>RadiusInit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> Pi32 <span class="token operator">*</span> Radius <span class="token operator">*</span> Radius<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 Radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Area sum</span>
f32 <span class="token function">TotalAreaVTBL</span><span class="token punctuation">(</span>u32 ShapeCount<span class="token punctuation">,</span> shape_base <span class="token operator">*</span><span class="token operator">*</span>Shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f32 Accum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShapeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Corner-weighted area sum</span>
f32 <span class="token function">CornerAreaVTBL</span><span class="token punctuation">(</span>u32 ShapeCount<span class="token punctuation">,</span> shape_base <span class="token operator">*</span><span class="token operator">*</span>Shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f32 Accum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShapeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token punctuation">(</span>f32<span class="token punctuation">)</span>Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>The clean code approach uses classic object-oriented principles. Each shape is encapsulated in its own class with specific behavior and data. The abstract <code>shape_base</code> class defines a common interface through pure virtual methods. At runtime, virtual function calls dispatch through vtables to the appropriate implementation, enabling polymorphism—the same aggregation code works with any mix of shape types.</p>
<h3 id="switch-code">Switch Code </h3>
<p>Procedural code using switch statements:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-enum">enum</span> <span class="token class-name">shape_type</span> <span class="token operator">:</span> u32 <span class="token punctuation">{</span>
    Shape_Square<span class="token punctuation">,</span>
    Shape_Rectangle<span class="token punctuation">,</span>
    Shape_Triangle<span class="token punctuation">,</span>
    Shape_Circle<span class="token punctuation">,</span>
    Shape_Count
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">shape_union</span> <span class="token punctuation">{</span>
    shape_type Type<span class="token punctuation">;</span>
    f32 Width<span class="token punctuation">;</span>
    f32 Height<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

f32 <span class="token function">GetAreaSwitch</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> shape_union<span class="token operator">&amp;</span> Shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>Shape<span class="token punctuation">.</span>Type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> Shape_Square<span class="token operator">:</span> <span class="token keyword keyword-return">return</span> Shape<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> Shape_Rectangle<span class="token operator">:</span> <span class="token keyword keyword-return">return</span> Shape<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Height<span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> Shape_Triangle<span class="token operator">:</span> <span class="token keyword keyword-return">return</span> <span class="token number">0.5f</span> <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Height<span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> Shape_Circle<span class="token operator">:</span> <span class="token keyword keyword-return">return</span> Pi32 <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
        <span class="token keyword keyword-default">default</span><span class="token operator">:</span> <span class="token keyword keyword-return">return</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
f32 <span class="token function">TotalAreaSwitch</span><span class="token punctuation">(</span>u32 ShapeCount<span class="token punctuation">,</span> shape_union<span class="token operator">*</span> Shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f32 Accum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShapeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> <span class="token function">GetAreaSwitch</span><span class="token punctuation">(</span>Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
f32 <span class="token function">CornerAreaSwitch</span><span class="token punctuation">(</span>u32 ShapeCount<span class="token punctuation">,</span> shape_union<span class="token operator">*</span> Shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f32 Accum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShapeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token punctuation">(</span>f32<span class="token punctuation">)</span><span class="token function">GetCornerCountSwitch</span><span class="token punctuation">(</span>Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">GetAreaSwitch</span><span class="token punctuation">(</span>Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>The switch approach abandons object-oriented design in favor of procedural programming. All shapes are represented by a single <code>shape_union</code> struct containing a type enum and generic dimensions (<code>Width</code>, <code>Height</code>). Shape-specific behavior is implemented through switch statements that branch based on the <code>Type</code> field. This eliminates virtual function calls and vtable lookups, allowing the compiler to generate jump tables or use branch prediction more effectively.</p>
<h3 id="table-code">Table Code </h3>
<p>Table-driven code using precomputed coefficients:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-enum">enum</span> <span class="token class-name">shape_type</span> <span class="token operator">:</span> u32 <span class="token punctuation">{</span>
    Shape_Square<span class="token punctuation">,</span>
    Shape_Rectangle<span class="token punctuation">,</span>
    Shape_Triangle<span class="token punctuation">,</span>
    Shape_Circle<span class="token punctuation">,</span>
    Shape_Count
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">shape_union</span> <span class="token punctuation">{</span>
    shape_type Type<span class="token punctuation">;</span>
    f32 Width<span class="token punctuation">;</span>
    f32 Height<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-const">const</span> f32 AreaCTable<span class="token punctuation">[</span>Shape_Count<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> Pi32<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-const">const</span> f32 CornerAreaCTable<span class="token punctuation">[</span>Shape_Count<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">0.5f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Pi32
<span class="token punctuation">}</span><span class="token punctuation">;</span>

f32 <span class="token function">GetAreaUnion</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> shape_union<span class="token operator">&amp;</span> Shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> AreaCTable<span class="token punctuation">[</span>Shape<span class="token punctuation">.</span>Type<span class="token punctuation">]</span> <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>Height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

f32 <span class="token function">CornerAreaUnion</span><span class="token punctuation">(</span>u32 ShapeCount<span class="token punctuation">,</span> shape_union<span class="token operator">*</span> Shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f32 Accum <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ShapeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> CornerAreaCTable<span class="token punctuation">[</span>Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Type<span class="token punctuation">]</span> <span class="token operator">*</span> Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Width <span class="token operator">*</span> Shapes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>The table-driven approach further simplifies the switch method by replacing conditional logic with precomputed tables of coefficients. Each shape type has associated constants for area calculation and corner-weighting stored in arrays. The area and corner-area functions simply index into these tables based on the shape type, multiplying the coefficients by the generic dimensions. This minimizes branching and can improve cache locality, potentially leading to better performance.</p>
<h2 id="part-2-software-quality-attributes">Part 2: Software Quality Attributes </h2>
<p>Object-oriented programming and clean coding practices weren't developed as academic exercises—they emerged as practical solutions to real problems that plagued software projects throughout their lifecycles, particularly around maintainability and extensibility.</p>
<p>In the 1990s, while working for several banks, I witnessed firsthand how seemingly minor oversights could spiral into catastrophic costs. The programmers who wrote the boot routines for the mainframes had long since retired or passed away, leaving behind impenetrable legacy code. No one dared shut down the systems for fear they wouldn't boot again. Banks spent millions on increasingly obsolete hardware just to keep these digital time bombs running.</p>
<p>This illustrates a crucial point: clean coding isn't about programmer "convenience"—it's about economic efficiency. Every micro-optimization demands additional development time, specialized testing, and extensive documentation. Optimizations often rely on clever tricks that sacrifice readability and maintainability. The critical question becomes: is your customer willing to pay these hidden costs for speed improvements they may never notice?</p>
<p>Runtime performance is undeniably important, but it must be weighed against other quality attributes. Professional software development is fundamentally about maximizing value while minimizing cost—delivering rich functionality with reasonable effort. "Functionality" here encompasses not just features, but the full spectrum of software qualities: reliability, maintainability, extensibility, portability, testability, and yes, execution speed.</p>
<p>Software needs to be "fast enough" for its context. For most user-facing applications, this means avoiding perceptible delays. In high-frequency trading or real-time systems, microseconds matter. But in many domains, obsessing over performance that users will never notice represents a costly misallocation of resources.</p>
<p>The principle is simple: optimize when performance becomes a genuine constraint, not preemptively. To paraphrase Einstein: "Make software as fast as needed, but not faster."</p>
<h2 id="part-3-maintainability-and-extensibility---the-hidden-costs-of-optimization">Part 3: Maintainability and Extensibility - The Hidden Costs of Optimization </h2>
<p>Let's examine how Muratori's optimizations fare during typical software evolution.</p>
<h3 id="the-burden-of-algorithm-changes">The Burden of Algorithm Changes </h3>
<p>Consider a seemingly simple change: upgrading triangle area calculation from the basic base×height formula to Heron's formula, which requires all three side lengths.</p>
<p><strong>In clean code</strong>, the change is straightforward:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">triangle</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token comment">// Updated constructor for three sides</span>
    <span class="token function">triangle</span><span class="token punctuation">(</span>f32 a<span class="token punctuation">,</span> f32 b<span class="token punctuation">,</span> f32 c<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">side_a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">side_b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">side_c</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    
    <span class="token comment">// Implement Heron's formula</span>
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> 
        f32 s <span class="token operator">=</span> <span class="token punctuation">(</span>side_a <span class="token operator">+</span> side_b <span class="token operator">+</span> side_c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span>s <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> side_a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> side_b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> side_c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Other methods unchanged</span>
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 side_a<span class="token punctuation">,</span> side_b<span class="token punctuation">,</span> side_c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p><strong>In switch code</strong>, we face a cascade of changes:</p>
<ol>
<li>First, we must modify the core data structure, because the existing <code>shape_union</code> is insufficient to represent a triangle with three sides:</li>
</ol>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">shape_union</span> <span class="token punctuation">{</span>
    shape_type Type<span class="token punctuation">;</span>
    <span class="token keyword keyword-union">union</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> f32 Width<span class="token punctuation">;</span> <span class="token punctuation">}</span> square<span class="token punctuation">;</span>
        <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> f32 Width<span class="token punctuation">;</span> f32 Height<span class="token punctuation">;</span> <span class="token punctuation">}</span> rect<span class="token punctuation">;</span>
        <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> f32 Side1<span class="token punctuation">;</span> f32 Side2<span class="token punctuation">;</span> f32 Side3<span class="token punctuation">;</span> <span class="token punctuation">}</span> tri<span class="token punctuation">;</span>  <span class="token comment">// New structure</span>
        <span class="token keyword keyword-struct">struct</span> <span class="token punctuation">{</span> f32 Radius<span class="token punctuation">;</span> <span class="token punctuation">}</span> circ<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li>Then update every function that processes shapes:</li>
</ol>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>f32 <span class="token function">GetAreaSwitch</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> shape_union<span class="token operator">&amp;</span> Shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>Shape<span class="token punctuation">.</span>Type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Must update all shape cases to use the new union</span>
        <span class="token keyword keyword-case">case</span> Shape_Square<span class="token operator">:</span> <span class="token keyword keyword-return">return</span> Shape<span class="token punctuation">.</span>square<span class="token punctuation">.</span>Width <span class="token operator">*</span> Shape<span class="token punctuation">.</span>square<span class="token punctuation">.</span>Width<span class="token punctuation">;</span>
        <span class="token comment">// Other shapes...</span>
        <span class="token keyword keyword-case">case</span> Shape_Triangle<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// Heron's formula</span>
            f32 a <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side1<span class="token punctuation">;</span>
            f32 b <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side2<span class="token punctuation">;</span>
            f32 c <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side3<span class="token punctuation">;</span>
            f32 s <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span>s <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ol start="3">
<li>All code that creates or manipulates shapes must be updated.</li>
</ol>
<p><strong>In table code</strong>, the situation is even worse:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>f32 <span class="token function">GetAreaUnion</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> shape_union<span class="token operator">&amp;</span> Shape<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The table approach completely breaks down</span>
    <span class="token comment">// We can no longer use a simple coefficient * width * height formula</span>
    
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Shape<span class="token punctuation">.</span>Type <span class="token operator">==</span> Shape_Triangle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Special case for triangles</span>
        f32 a <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side1<span class="token punctuation">;</span>
        f32 b <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side2<span class="token punctuation">;</span>
        f32 c <span class="token operator">=</span> Shape<span class="token punctuation">.</span>tri<span class="token punctuation">.</span>Side3<span class="token punctuation">;</span>
        f32 s <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span>s <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>s <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use table for other shapes</span>
        <span class="token keyword keyword-return">return</span> AreaCTable<span class="token punctuation">[</span>Shape<span class="token punctuation">.</span>Type<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token comment">/* shape-specific dimensions */</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>The table approach fundamentally breaks because Heron's formula doesn't fit the coefficient pattern assumed by the table design.</p>
<p>Because Muratori restructured the entire architecture for runtime performance, a simple algorithmic change to one shape's method cascades into a complete program rewrite. The table-driven approach fares even worse—it fundamentally breaks under this change.</p>
<h3 id="the-library-extensibility-challenge">The Library Extensibility Challenge </h3>
<p>The maintainability problems are clear, but what about extensibility? The clean code approach represents a common library scenario where third parties should be able to add new shape types. Let's test this by adding a hexagon shape.</p>
<p><strong>In clean code</strong>, third parties can extend the system without any changes to your library:</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// Third-party code:</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">hexagon</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword keyword-public">public</span> <span class="token class-name">shape_base</span></span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">hexagon</span><span class="token punctuation">(</span>f32 side_length<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m_side</span><span class="token punctuation">(</span>side_length<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    f32 <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> 
        <span class="token keyword keyword-return">return</span> <span class="token number">1.5f</span> <span class="token operator">*</span> <span class="token function">sqrtf</span><span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">)</span> <span class="token operator">*</span> m_side <span class="token operator">*</span> m_side<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    
    u32 <span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-override">override</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    f32 m_side<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Works with all existing library functions</span>
f32 total <span class="token operator">=</span> <span class="token function">TotalAreaVTBL</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>myHexagon<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>In switch code</strong>, every function must be modified to handle hexagons. Library vendors would need to provide full source code for customers to add shapes—but what happens when you release the next version? Customer modifications become merge conflicts.</p>
<p><strong>In table code</strong>, extension requires either modifying the library source or creating wrapper layers that defeat the original optimization.</p>
<p>Muratori's optimizations extract a steep price: they sacrifice both maintainability and extensibility. This forces a strategic choice: invest in flexible, maintainable software that may require faster hardware (which becomes cheaper annually), or lock yourself into highly optimized but inflexible code frozen in time?</p>
<h2 id="part-4-performance-claims-analysis">Part 4: Performance Claims Analysis </h2>
<h3 id="the-fundamental-methodological-flaw">The Fundamental Methodological Flaw </h3>
<p>Before examining the performance numbers, we must address a critical issue with Muratori's comparison methodology: <strong>he compares demo-quality clean code against highly optimized implementations</strong>. This is fundamentally unfair—like comparing a bicycle against a Formula 1 race car and concluding that bicycles are inherently slow.</p>
<p>Muratori's "clean code" baseline appears designed for readability and teaching purposes, not performance. It lacks even basic optimizations that would be standard in any performance-sensitive clean code implementation:</p>
<ul>
<li>No loop unrolling</li>
<li>No compiler optimization flags consideration</li>
<li>No data structure optimization</li>
<li>No algorithmic improvements</li>
<li>No consideration of cache-friendly patterns</li>
</ul>
<p>Meanwhile, his "optimized" versions employ aggressive techniques:</p>
<ul>
<li>Manual loop unrolling</li>
<li>Processor-specific optimizations</li>
<li>Cache-optimized data layouts</li>
<li>Branch prediction exploitation</li>
</ul>
<p><strong>A fair comparison would pit optimized clean code against optimized procedural code</strong>, not demo code against production-tuned implementations. This methodological flaw undermines the entire premise that clean code is inherently slower.</p>
<h3 id="empirical-verification">Empirical Verification </h3>
<p>Despite this methodological issue, let's examine the actual performance claims. Muratori's performance claims lack reproducible benchmark code, reporting that his optimized versions run 25 times faster than the clean code baseline. To verify these claims, I implemented his code samples and created comprehensive benchmarks. Testing on an AMD Ryzen 7 8745H yielded these results:</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Time (ms)</th>
<th>Speedup Factor</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clean Code TotalArea</td>
<td>2.505</td>
<td>1.0x (baseline)</td>
</tr>
<tr>
<td>Clean Code TotalArea4</td>
<td>1.007</td>
<td>2.49x</td>
</tr>
<tr>
<td>Clean Code CornerArea</td>
<td>5.355</td>
<td>1.0x (baseline)</td>
</tr>
<tr>
<td>Clean Code CornerArea4</td>
<td>2.153</td>
<td>2.49x</td>
</tr>
<tr>
<td>Switch TotalArea</td>
<td>0.661</td>
<td>3.79x</td>
</tr>
<tr>
<td>Switch TotalArea4</td>
<td>0.397</td>
<td>6.31x</td>
</tr>
<tr>
<td>Switch CornerArea</td>
<td>0.637</td>
<td>8.41x</td>
</tr>
<tr>
<td>Switch CornerArea4</td>
<td>0.536</td>
<td>9.99x</td>
</tr>
<tr>
<td>Table TotalArea</td>
<td>0.633</td>
<td>3.96x</td>
</tr>
<tr>
<td>Table TotalArea4</td>
<td>0.334</td>
<td>7.50x</td>
</tr>
<tr>
<td>Table CornerArea</td>
<td>0.626</td>
<td>8.56x</td>
</tr>
<tr>
<td>Table CornerArea4</td>
<td>0.332</td>
<td>16.13x</td>
</tr>
</tbody>
</table>
<p>The results show the best optimized version achieving 16x improvement over baseline clean code—or 6.5x compared to unrolled clean code. While significant, this falls short of Muratori's claimed 25x speedup.</p>
<p>More importantly, these optimizations exploit processor-specific features:</p>
<ul>
<li>Loop unrolling enables pipelining</li>
<li>Switch-case code leverages branch prediction</li>
<li>Table-driven code exploits cache optimization</li>
</ul>
<p>These advantages only materialize on processors supporting specific optimization techniques. While most modern processors include these features, future architectures might render them obsolete—or even favor different approaches like optimized indirection. Today's micro-optimizations could become tomorrow's performance bottlenecks.</p>
<p>The platform dependency runs deeper than architecture evolution. On resource-constrained processors, these optimizations can backfire: I once achieved 150% speedup on a PIC microcontroller by replacing switch statements with function pointer arrays—the exact opposite of Muratori's recommendation.</p>
<p>Muratori makes a particularly striking analogy:</p>
<blockquote>
<p><em>To put that in hardware terms, it would be like taking an iPhone 14 Pro Max and reducing it to an iPhone 11 Pro Max. It's three or four years of hardware evolution erased because somebody said to use polymorphism instead of switch statements.</em></p>
</blockquote>
<p>This argument contains internal contradictions. The optimizations he advocates only work effectively on modern hardware—the very hardware he claims is being "erased." Furthermore, if we accepted this logic consistently, we'd need to ban all interpreted languages (which would regress an iPhone 14 to iPhone 3 performance) and abandon high-level languages entirely in favor of hand-optimized assembly.</p>
<h3 id="the-broader-performance-picture">The Broader Performance Picture </h3>
<p>Modern compilers increasingly eliminate performance gaps that once required manual intervention. Advanced optimization techniques—inlining, dead code elimination, profile-guided optimization—often match or exceed hand-tuned code while maintaining portability and forward compatibility.</p>
<p>Real-world performance bottlenecks rarely lie in computational hotpaths like shape calculations. Database queries, network latency, and I/O operations typically dominate performance profiles. Optimizing the wrong component—no matter how elegantly—delivers negligible user-visible improvements.</p>
<p>Algorithmic improvements consistently outweigh micro-optimizations. Converting an O(n²) algorithm to O(n log n) dwarfs any low-level tweaking benefits. Moreover, clean, portable code positions itself to benefit from future compiler advances and hardware evolution without requiring architectural rewrites.</p>
<h2 id="part-5-optimized-clean-code--the-best-of-both-worlds">Part 5: Optimized Clean Code – The Best of Both Worlds </h2>
<p>This section demonstrates how to preserve clean, object-oriented interfaces while achieving exceptional performance through strategic optimization. The approach separates three distinct concerns:</p>
<ol>
<li><strong>Data Collection</strong>: Maintaining clean object-oriented interfaces for domain logic</li>
<li><strong>Precomputation</strong>: Extracting and caching invariant data once per shape</li>
<li><strong>Vectorized Aggregation</strong>: Performing bulk calculations using SIMD instructions</li>
</ol>
<p>Crucially, only the final step involves hardware-specific optimizations—the domain model and data collection remain clean, maintainable, and extensible.</p>
<h3 id="51-collectors-bridging-clean-code-and-performance">5.1 Collectors: Bridging Clean Code and Performance </h3>
<p>The collector pattern creates a thin adaptation layer between the clean object interface and optimized computation. These classes extract precisely what the performance-critical loops require:</p>
<ul>
<li><code>AreaCollector</code>: stores raw areas in a contiguous <code>std::vector&lt;float&gt;</code></li>
<li><code>CornerCollector</code>: stores areas plus precomputed weight <code>1/(1+corner_count)</code>, paying the expensive division and virtual call costs once per shape rather than inside the SIMD loop</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">AreaCollector</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    shape_base<span class="token operator">*</span> <span class="token function">addShape</span><span class="token punctuation">(</span>shape_base<span class="token operator">*</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        areas<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>f32<span class="token operator">&gt;</span> areas<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">CornerCollector</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    shape_base<span class="token operator">*</span> <span class="token function">addShape</span><span class="token punctuation">(</span>shape_base<span class="token operator">*</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        f32 a <span class="token operator">=</span> s<span class="token operator">-&gt;</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f32 w <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1.0f</span> <span class="token operator">+</span> <span class="token punctuation">(</span>f32<span class="token punctuation">)</span>s<span class="token operator">-&gt;</span><span class="token function">CornerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        areas<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        weights<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>f32<span class="token operator">&gt;</span> areas<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>f32<span class="token operator">&gt;</span> weights<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>These collectors preserve domain model clarity while organizing data for optimal CPU utilization—the best of both architectural worlds.</p>
<h3 id="52-precomputation-pay-once-benefit-repeatedly">5.2 Precomputation: Pay Once, Benefit Repeatedly </h3>
<p>The setup phase maintains the familiar polymorphic shape interface while simultaneously feeding the collectors. Virtual method dispatch occurs exactly once per shape during data collection—subsequent aggregation becomes pure vectorized arithmetic.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>shape_base<span class="token operator">*</span><span class="token operator">&gt;</span> shapes<span class="token punctuation">;</span>
AreaCollector area_collector<span class="token punctuation">;</span>
CornerCollector corner_collector<span class="token punctuation">;</span>

<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>u32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">0</span><span class="token operator">:</span> shapes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token operator">:</span> shapes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">rectangle</span><span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token operator">:</span> shapes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">triangle</span><span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token operator">:</span> shapes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token function">circle</span><span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    area_collector<span class="token punctuation">.</span><span class="token function">addShape</span><span class="token punctuation">(</span>shapes<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    corner_collector<span class="token punctuation">.</span><span class="token function">addShape</span><span class="token punctuation">(</span>shapes<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>This architectural transformation splits virtual-dispatch-heavy reduction into two clean phases: gather and crunch. Porting to different architectures or vector widths leaves the gathering logic completely untouched.</p>
<h3 id="53-vectorized-aggregation-where-performance-magic-happens">5.3 Vectorized Aggregation: Where Performance Magic Happens </h3>
<p>The aggregation layer operates on contiguous float arrays, deploying the full arsenal of modern CPU optimization: AVX 256-bit intrinsics for 8-wide parallelism, aggressive loop unrolling, multiple accumulators to hide pipeline latency, intelligent prefetching for cache optimization, and fused multiply-add (FMA) operations.</p>
<p>Area aggregation (abridged for focus):</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code>f32 <span class="token function">TotalAreaCollector</span><span class="token punctuation">(</span>AreaCollector<span class="token operator">&amp;</span> collector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use SIMD for faster summation</span>
    <span class="token keyword keyword-const">const</span> size_t size <span class="token operator">=</span> collector<span class="token punctuation">.</span>areas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> f32<span class="token operator">*</span> areas <span class="token operator">=</span> collector<span class="token punctuation">.</span>areas<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Use 8 accumulators for even better pipelining and to utilize more registers</span>
    __m256 sum0 <span class="token operator">=</span> <span class="token function">_mm256_setzero_ps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// sum1 - sum6 omitted for brevity</span>
    __m256 sum7 <span class="token operator">=</span> <span class="token function">_mm256_setzero_ps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Process 64 elements at a time - further unrolled loop with prefetching</span>
    size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token comment">// For very large arrays, first prefetch ahead</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_mm_prefetch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _MM_HINT_T0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm_prefetch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _MM_HINT_T0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">+</span> <span class="token number">63</span> <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Prefetch next iterations to L1 cache</span>
        <span class="token function">_mm_prefetch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _MM_HINT_T0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_mm_prefetch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _MM_HINT_T0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Fully unrolled loop for 64 elements with 8 accumulators</span>
        <span class="token comment">// This eliminates loop overhead and maximizes instruction-level parallelism</span>
        sum0 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> <span class="token function">_mm256_loadu_ps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// sum1 - sum6 omitted for brevity</span>
        sum7 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum7<span class="token punctuation">,</span> <span class="token function">_mm256_loadu_ps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">56</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Combine the 8 accumulators into 4</span>
    sum0 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> sum4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// sum1 - sum6 omitted for brevity</span>
    sum3 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum3<span class="token punctuation">,</span> sum7<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Combine the 4 accumulators into 2</span>
    sum0 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> sum1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sum2 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum2<span class="token punctuation">,</span> sum3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Combine the 2 accumulators into 1</span>
    sum0 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Now process 8 elements at a time for remaining data</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum0 <span class="token operator">=</span> <span class="token function">_mm256_add_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> <span class="token function">_mm256_loadu_ps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Extract result from AVX register using more efficient horizontal sum</span>
    __m128 high128 <span class="token operator">=</span> <span class="token function">_mm256_extractf128_ps</span><span class="token punctuation">(</span>sum0<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __m128 low128 <span class="token operator">=</span> <span class="token function">_mm256_castps256_ps128</span><span class="token punctuation">(</span>sum0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    __m128 sum128 <span class="token operator">=</span> <span class="token function">_mm_add_ps</span><span class="token punctuation">(</span>high128<span class="token punctuation">,</span> low128<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Horizontal sum of 128-bit SSE vector - optimized version</span>
    sum128 <span class="token operator">=</span> <span class="token function">_mm_hadd_ps</span><span class="token punctuation">(</span>sum128<span class="token punctuation">,</span> sum128<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sum128 <span class="token operator">=</span> <span class="token function">_mm_hadd_ps</span><span class="token punctuation">(</span>sum128<span class="token punctuation">,</span> sum128<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    f32 Accum <span class="token operator">=</span> <span class="token function">_mm_cvtss_f32</span><span class="token punctuation">(</span>sum128<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Handle remaining elements</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Accum <span class="token operator">+=</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword keyword-return">return</span> Accum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><p>The CornerAreaCollector follows similar patterns with additional complexity for weighted calculations. (Complete implementation details are available in the code repository<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.)</p>
<p>The optimization arsenal deployed includes:</p>
<ul>
<li><strong>SIMD (AVX) Instructions</strong>: 8-way parallel processing of floating-point data</li>
<li><strong>Aggressive Loop Unrolling</strong>: Multiple accumulators to maximize instruction-level parallelism</li>
<li><strong>Intelligent Prefetching</strong>: Proactive cache loading for large datasets</li>
<li><strong>Fused Multiply-Add (FMA)</strong>: Single-instruction <code>a*b + c</code> operations for weighted sums</li>
</ul>
<h3 id="speed-comparison-clean-code-vs-switch-vs-table">Speed Comparison: Clean Code vs. Switch vs. Table </h3>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>TotalArea (ms)</th>
<th>CornerArea (ms)</th>
<th>Speed-up vs OOP baseline</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clean Code (OOP)</td>
<td>2.516</td>
<td>5.603</td>
<td>1.0x</td>
</tr>
<tr>
<td>Clean Code (4x unrolled)</td>
<td>1.023</td>
<td>2.000</td>
<td>2.5x / 2.8x</td>
</tr>
<tr>
<td>Switch-based</td>
<td>0.644</td>
<td>0.643</td>
<td>3.9x / 8.7x</td>
</tr>
<tr>
<td>Switch-based (4x unrolled)</td>
<td>0.379</td>
<td>0.531</td>
<td>6.6x / 10.6x</td>
</tr>
<tr>
<td>Table-driven</td>
<td>0.639</td>
<td>0.655</td>
<td>3.9x / 8.6x</td>
</tr>
<tr>
<td>Table-driven (4x unrolled)</td>
<td>0.337</td>
<td>0.335</td>
<td>7.5x / 16.7x</td>
</tr>
<tr>
<td><strong>Optimized Clean Code</strong></td>
<td><strong>0.035</strong></td>
<td><strong>0.075</strong></td>
<td><strong>72x / 75x</strong></td>
</tr>
</tbody>
</table>
<p>These values were measured on a AMD Ryzen 7 8745H with GCC 13.3.0 and all optimizations enabled.</p>
<h2 id="conclusion-transcending-false-dichotomies">Conclusion: Transcending False Dichotomies </h2>
<p>The supposed trade-off between clean code and performance represents a false choice. Our optimized implementation delivers 70x performance improvement while preserving sound software engineering principles. The key insight: strategic separation of concerns allows targeted optimization where it matters most, creating systems that are simultaneously clean and fast without sacrificing maintainability or extensibility.</p>
<p><strong>The path forward combines:</strong></p>
<ul>
<li><strong>Clean interfaces</strong> that preserve domain clarity and enable extension</li>
<li><strong>Strategic optimization</strong> applied only where performance demands it</li>
<li><strong>Architectural separation</strong> between business logic and computational efficiency</li>
<li><strong>Modern tooling</strong> (SIMD, advanced compilers) used judiciously rather than universally</li>
</ul>
<p>This approach delivers genuine value: software that performs exceptionally while remaining adaptable to changing requirements and maintainable across its entire lifecycle.</p>
<hr>
<h2 id="epilogue-lessons-from-the-benchmarking-journey">Epilogue: Lessons from the Benchmarking Journey </h2>
<p>Writing this response uncovered surprising insights that extend beyond the main argument. One particular claim from Muratori sparked additional investigation:</p>
<blockquote>
<p><em>Personally, I wouldn't say that a switch statement is inherently less polymorphic than a vtable. They are just two different implementations of the same thing. But, the "clean" code rules say to prefer polymorphism to switch statements, so I'm using their terminology here, where clearly they don't think a switch statement is polymorphic.</em></p>
</blockquote>
<p>While Part 3 demonstrates fundamental architectural differences between switch statements and virtual methods, Muratori's performance observations about switches proved intriguingly counterintuitive.</p>
<h3 id="the-branch-prediction-revelation">The Branch Prediction Revelation </h3>
<p>Traditional wisdom suggested avoiding large switch statements due to performance penalties—multiple comparisons versus virtual methods' simple double indirection. Even accounting for branch prediction, there should theoretically be a crossover point where virtual tables become faster than switches.</p>
<p>Determined to find this crossover, I wrote benchmark programs scaling from small switch statements up to 1000 cases. The results were startling: <strong>switches remained significantly faster even at 1000 cases</strong>. Modern branch prediction has become remarkably sophisticated, challenging decades-old performance assumptions and raising intriguing questions about optimal compiler implementation strategies for virtual method dispatch.</p>
<p>This discovery reinforces the importance of empirical measurement over inherited assumptions—the performance landscape continues evolving with hardware advances.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>All benchmark code, implementations, and build instructions are available at: <a href="https://github.com/kochelmonster/articles/tree/master/cleancode">https://github.com/kochelmonster/articles/tree/master/cleancode</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>